<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Dissyboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #202225; color: #dcddde; }
        .navbar { background-color: #2f3136; }
        .nav-tabs .nav-link { color: #dcddde; border-color: #40444b; }
        .nav-tabs .nav-link.active { background-color: #40444b; border-color: #40444b; color: #fff; }
        .server-card { background-color: #2f3136; border: 1px solid #40444b; }
        .server-card .card-title { color: #fff; }
        .server-card .card-subtitle { color: #72767d; }
        .server-card .card-img-top { height: 150px; object-fit: cover; background-color: #202225; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="/"><i class="bi bi-shield-lock"></i> Admin Dashboard</a>
        <a href="/" class="btn btn-outline-secondary">Zurück zur Startseite</a>
    </div>
</nav>

<main class="container mt-4">
    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs mb-3" id="adminTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending-tab-pane" type="button" role="tab">Ausstehend</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved-tab-pane" type="button" role="tab">Angenommen</button>
        </li>
    </ul>

    <!-- Tabs Content -->
    <div class="tab-content" id="adminTabsContent">
        <div class="tab-pane fade show active" id="pending-tab-pane" role="tabpanel">
            <div id="pending-servers" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                <!-- Ausstehende Server hier -->
            </div>
        </div>
        <div class="tab-pane fade" id="approved-tab-pane" role="tabpanel">
            <div id="approved-servers" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                <!-- Angenommene Server hier -->
            </div>
        </div>
    </div>
</main>

<script>
    async function fetchAndRenderServers() {
        const response = await fetch('/api/servers');
        const servers = await response.json();

        const pendingContainer = document.getElementById('pending-servers');
        const approvedContainer = document.getElementById('approved-servers');
        
        const pending = servers.filter(s => s.status === 'pending');
        const approved = servers.filter(s => s.status === 'approved');

        pendingContainer.innerHTML = pending.length > 0 ? pending.map(server => `
            <div class="col" id="server-${server.id}">
                <div class="card server-card h-100">
                    <img src="${server.imageUrl || 'https://via.placeholder.com/400x225/2f3136/72767d?text=Kein+Bild'}" class="card-img-top" alt="Eingereichtes Bild">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${server.serverName}</h5>
                        <h6 class="card-subtitle mb-2">Eingereicht von: ${server.submittedBy.username}</h6>
                        <p class="card-text text-white-50">${server.description}</p>
                        <a href="${server.inviteLink}" class="card-link" target="_blank">Link testen</a>
                        <div class="mt-3">
                            <button class="btn btn-success btn-sm" onclick="manageServer('${server.id}', 'approve')"><i class="bi bi-check-lg"></i> Annehmen</button>
                            <button class="btn btn-danger btn-sm" onclick="manageServer('${server.id}', 'decline')"><i class="bi bi-x-lg"></i> Ablehnen</button>
                        </div>
                    </div>
                </div>
            </div>
        `).join('') : '<p class="text-white-50">Keine ausstehenden Server.</p>';

        approvedContainer.innerHTML = approved.length > 0 ? approved.map(server => `
            <div class="col" id="server-${server.id}">
                <div class="card server-card h-100">
                    <img src="${server.imageUrl || 'https://via.placeholder.com/400x225/2f3136/72767d?text=Kein+Bild'}" class="card-img-top" alt="Server Bild">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title">${server.serverName}</h5>
                        <h6 class="card-subtitle mb-2">Eingereicht von: ${server.submittedBy.username}</h6>
                        <p class="card-text text-white-50 flex-grow-1">${server.description}</p>
                        <div class="mt-auto">
                            <button class="btn btn-warning btn-sm" onclick="manageServer('${server.id}', 'delete')"><i class="bi bi-trash"></i> Löschen</button>
                        </div>
                    </div>
                </div>
            </div>
        `).join('') : '<p class="text-white-50">Keine angenommenen Server.</p>';
    }

    async function manageServer(id, action) {
        if (!confirm(`Bist du sicher, dass du diese Aktion (${action}) ausführen möchtest?`)) {
            return;
        }
        await fetch(`/api/servers/${id}/${action}`, { method: 'POST' });
        fetchAndRenderServers();
    }

    document.addEventListener('DOMContentLoaded', fetchAndRenderServers);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>